DROP DATABASE IF EXISTS BibliotecaDB;
CREATE DATABASE BibliotecaDB;
USE BibliotecaDB;

CREATE TABLE tb_autor (
  id_autor INT PRIMARY KEY NOT NULL IDENTITY,
  nm_autor VARCHAR(90) NOT NULL,
  nm_nomeCompleto VARCHAR(150) NULL,
  ds_nacionalidade VARCHAR(90) NULL);


CREATE TABLE tb_genero (
  id_genero INT PRIMARY KEY NOT NULL IDENTITY,
  nm_genero VARCHAR(100) NOT NULL,);

CREATE TABLE tb_livro (
  id_livro INT PRIMARY KEY NOT NULL IDENTITY,
  ds_titulo VARCHAR(90) NOT NULL,
  ds_tipo VARCHAR(45) NOT NULL,
  ds_condicoes VARCHAR(40) NOT NULL,
  ds_idioma VARCHAR(30) NOT NULL,
  nm_editora VARCHAR(100) NOT NULL,
  nu_volume INT NOT NULL,
  nu_isbn VARCHAR(20) NULL DEFAULT NULL,
  ds_subtitulo VARCHAR(150) NULL DEFAULT NULL,
  ds_palavrasChaves VARCHAR(300) NULL DEFAULT NULL,
  img_Capa varbinary (max) NULL,
  autor_id_autor INT NOT NULL,
  tb_genero_id_genero INT NOT NULL,
    FOREIGN KEY (autor_id_autor)
    REFERENCES tb_autor (id_autor),
    FOREIGN KEY (tb_genero_id_genero)
    REFERENCES tb_genero (id_genero));

CREATE TABLE tb_aluno (
  id_aluno INT PRIMARY KEY NOT NULL IDENTITY,
  nm_aluno VARCHAR(150) NOT NULL);

CREATE TABLE tb_curso (
  id_curso INT PRIMARY KEY NOT NULL IDENTITY,
  nm_curso VARCHAR(50) NOT NULL);

CREATE TABLE tb_turma (
  id_turma INT PRIMARY KEY NOT NULL IDENTITY,
  nm_turma VARCHAR(45) NOT NULL,
  ds_periodo VARCHAR(45) NOT NULL,
  curso_id_curso INT NOT NULL,
    FOREIGN KEY (curso_id_curso)
    REFERENCES tb_curso (id_curso));

CREATE TABLE tb_turma_aluno (
  id_turma_aluno INT PRIMARY KEY NOT NULL IDENTITY,
  nr_chamada INT NOT NULL,
  cd_ra INT NOT NULL,
  aluno_id_aluno INT NOT NULL,
  turma_id_turma INT NOT NULL,
    FOREIGN KEY (aluno_id_aluno)
    REFERENCES tb_aluno (id_aluno),
    FOREIGN KEY (turma_id_turma)
    REFERENCES tb_turma (id_turma));

CREATE TABLE tb_emprestimo (
  id_emprestimo INT PRIMARY KEY NOT NULL IDENTITY,
  dt_emprestimo DATE NOT NULL,
  dt_devolucao DATE NOT NULL,
  nm_funcionario VARCHAR(100) NOT NULL,
  livro_id_livro INT NOT NULL,
  tb_turma_aluno_id_turma_aluno INT NOT NULL,
    FOREIGN KEY (livro_id_livro)
    REFERENCES tb_livro (id_livro),
    FOREIGN KEY (tb_turma_aluno_id_turma_aluno)
    REFERENCES tb_turma_aluno (id_turma_aluno));

CREATE TABLE tb_estoque (
  id_estoque INT PRIMARY KEY NOT NULL IDENTITY,
  livro_id_livro INT NOT NULL,
  qtd_livro INT NOT NULL,
    FOREIGN KEY (livro_id_livro)
    REFERENCES tb_livro (id_livro));